pool:
  name: cyt-solaris-eastus
steps:
- task: CopyFiles@2
  displayName: 'Copy Files: To Build Binaries Directory'
  inputs:
    TargetFolder: '$(Build.BinariesDirectory)'
    CleanTargetFolder: true

- task: DeleteFiles@1
  displayName: 'Delete files from $(Build.BinariesDirectory)'
  inputs:
    SourceFolder: '$(Build.BinariesDirectory)'
    Contents: README.md
    RemoveDotFiles: true

- script: |
   cd $(Build.BinariesDirectory)\
   dir
   python -m pip install -r requirements.txt
   python -m pytest -v -m C29642 --self-contained-html --nunitxml=Reports/test-results.xml .\testCases\ --env="test"
   
   echo "FETCH LOG FILE - DISPLAY CONTENT"
   cd $(Build.BinariesDirectory)\logs\
   type testlog.log
  displayName: 'Command Line Script'

- task: PublishTestResults@2
  displayName: 'Publish Results'
  inputs:
    testResultsFormat: NUnit
    searchFolder: '$(Build.BinariesDirectory)'
    testRunTitle: 'Py Result'
- task: publishhtmlreport@1
  inputs:
    htmlType: 'genericHTML'
    htmlPath: '$(Build.BinariesDirectory)/Reports/*.html'

- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: test-automation'
  inputs:
    PathtoPublish: '$(Build.BinariesDirectory)/C29642_results.zip'
    ArtifactName: 'test-automation'
