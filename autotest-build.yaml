pool:
  name: cyt-vs2019-eastus

parameters:
- name: env
  displayName: Environment
  type: object
  default: 'test'

- name: testcase
  displayName: Test Case ID
  type: string
  default: 'C40493'

steps:
- ${{ each environment in parameters.env }}:
  - script: |
     python -m pip install -r requirements.txt
     python -m pytest -v -m ${{ parameters.testcase }} --self-contained-html --nunitxml=Reports/test-results.xml .\testCases\ --env=${{ environment }}
     
     echo "FETCH LOG FILE - DISPLAY CONTENT"
     cd $(Build.BinariesDirectory)\logs\
     type testlog.log
    displayName: '${{ environment }}'
  
  - task: PublishTestResults@2
    displayName: 'Publish Results'
    inputs:
      testResultsFormat: NUnit
      searchFolder: '$(System.DefaultWorkingDirectory)'
      testRunTitle: 'Py Result ${{ environment }}'
  
  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact: test-automation'
    inputs:
      PathtoPublish: '$(System.DefaultWorkingDirectory)/${{ parameters.testcase }}_${{ environment }}_results.zip'
      ArtifactName: 'test-automation'
  