pool:
  name: cyt-vs2019-eastus

parameters:
- name: env
  displayName: Environment
  type: string
  default: 'test'
  values:
    - test
    - staging
    - production

- name: testcase
  displayName: Test Case ID
  type: string
  default: 'C40493'

steps:
  - script: |
     python -m pip install -r requirements.txt
     python -m pytest -v -m ${{ parameters.testcase }} --self-contained-html --nunitxml=Reports/test-results.xml .\testCases\ --env=${{ parameters.env }}
     
     echo "FETCH LOG FILE - DISPLAY CONTENT"
     cd $(Build.BinariesDirectory)\logs\
     type testlog.log
    displayName: '${{ parameters.env }}_script'
  
  - task: PublishTestResults@2
    displayName: 'Publish Test Results'
    inputs:
      testResultsFormat: NUnit
      searchFolder: '$(System.DefaultWorkingDirectory)'
      testRunTitle: 'Py Result ${{ parameters.env }}'
  
  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact'
    inputs:
      PathtoPublish: '$(System.DefaultWorkingDirectory)\*.pdf'
      ArtifactName: 'test-automation'